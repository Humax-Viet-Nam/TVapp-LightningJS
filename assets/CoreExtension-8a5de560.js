var oe=Object.defineProperty;var ce=(r,n,e)=>n in r?oe(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var a=(r,n,e)=>(ce(r,typeof n!="symbol"?n+"":n,e),e);function ue(r){const n={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1};return r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}function m(r,n){if(!r)throw new Error(n||"Assertion failed")}function Be(r,n,e){const t=Math.trunc(r>>>24),s=Math.trunc(r>>>16&255),i=Math.trunc(r>>>8&255),o=Math.trunc(r&255),h=Math.trunc(n>>>24),u=Math.trunc(n>>>16&255),d=Math.trunc(n>>>8&255),x=Math.trunc(n&255),f=Math.round(h*e+t*(1-e)),R=Math.round(u*e+s*(1-e)),E=Math.round(d*e+i*(1-e)),p=Math.round(x*e+o*(1-e));return(f<<24|R<<16|E<<8|p)>>>0}function Le(r,n){const e=r>>>24,t=r>>>16&255,s=r>>>8&255,i=Math.trunc((r&255)*n);return(e<<24|t<<16|s<<8|i)>>>0}function Oe(r,n,e=!1){const t=(r&255)/255*n,s=Math.trunc((r>>>24)*t),i=Math.trunc((r>>>16&255)*t),o=Math.trunc((r>>>8&255)*t),h=Math.trunc(t*255);return e?(h<<24|o<<16|i<<8|s)>>>0:(s<<24|i<<16|o<<8|h)>>>0}function v(r,n){return Object.prototype.hasOwnProperty.call(r,n)}class ee{constructor(){a(this,"eventListeners",{})}on(n,e){let t=this.eventListeners[n];t||(t=[]),t.push(e),this.eventListeners[n]=t}off(n,e){const t=this.eventListeners[n];if(!t)return;if(!e){delete this.eventListeners[n];return}const s=t.indexOf(e);s>=0&&t.splice(s,1)}once(n,e){const t=(s,i)=>{this.off(n,t),e(s,i)};this.on(n,t)}emit(n,e){const t=this.eventListeners[n];t&&[...t].forEach(s=>{s(this,e)})}removeAllListeners(){this.eventListeners={}}}const Q=r=>r&&!(r&r-1),g=(r,n,e,t)=>{const s=3*r,i=3*(e-r)-s,o=1-s-i,h=3*n,u=3*(t-n)-h,d=1-h-u;return function(x){if(x>=1)return 1;if(x<=0)return 0;let f=.5,R,E,p;for(let _=0;_<20;_++){if(R=f*(f*(f*o+i)+s),p=x-R,p>-1e-8&&p<1e-8)return f*(f*(f*d+u)+h);if(E=f*(f*(3*o)+2*i)+s,E>1e-10&&E<1e-10)break;f+=p/E}let l=0,T=1;for(let _=0;_<20;_++){if(f=.5*(l+T),R=f*(f*(f*o+i)+s),p=x-R,p>-1e-8&&p<1e-8)return f*(f*(f*d+u)+h);p<0?T=f:l=f}}},Ne=r=>{switch(r){case"linear":return function(e){return e};case"ease":return g(.25,.1,.25,1);case"ease-in":return g(.42,0,1,1);case"ease-out":return g(0,0,.58,1);case"ease-in-out":return g(.42,0,.58,1);case"ease-in-sine":return g(.12,0,.39,0);case"ease-out-sine":return g(.12,0,.39,0);case"ease-in-out-sine":return g(.37,0,.63,1);case"ease-in-cubic":return g(.32,0,.67,0);case"ease-out-cubic":return g(.33,1,.68,1);case"ease-in-out-cubic":return g(.65,0,.35,1);case"ease-in-circ":return g(.55,0,1,.45);case"ease-out-circ":return g(0,.55,.45,1);case"ease-in-out-circ":return g(.85,0,.15,1);case"ease-in-back":return g(.36,0,.66,-.56);case"ease-out-back":return g(.34,1.56,.64,1);case"ease-in-out-back":return g(.68,-.6,.32,1.6);case"step-start":return function(){return 1};case"step-end":return function(e){return e===1?1:0};default:const n="cubic-bezier(";if(r&&r.indexOf(n)===0){const e=r.substr(n.length,r.length-n.length-1).split(",");if(e.length!==4)return console.warn("Unknown timing function: "+r),function(h){return h};const t=parseFloat(e[0]||"0.42"),s=parseFloat(e[1]||"0"),i=parseFloat(e[2]||"1"),o=parseFloat(e[3]||"1");return isNaN(t)||isNaN(s)||isNaN(i)||isNaN(o)?(console.warn(" Unknown timing function: "+r),function(h){return h}):g(t,s,i,o)}else return console.warn("Unknown timing function: "+r),function(e){return e}}};Math.hypot||(Math.hypot=(...r)=>{let n=0,e=r.length;for(;e--;)n+=r[e]*r[e];return Math.sqrt(n)});const he=r=>{const n=r>>>24,e=r>>>16&255,t=r>>>8&255,s=r&255;return[n/255,e/255,t/255,s/255]};function Pe(r){return(r&255)/255}function Ge(r){const n=Math.floor(r[0]*255),e=Math.floor(r[1]*255),t=Math.floor(r[2]*255),s=Math.floor(r[3]*255);return"rgba(".concat(n,",").concat(e,",").concat(t,",").concat(s.toFixed(4),")")}function j(r,n,e,t,s){return s?(s.x1=r,s.y1=n,s.x2=e,s.y2=t,s):{x1:r,y1:n,x2:e,y2:t}}function De(r,n,e){const t=j(Math.max(r.x1,n.x1),Math.max(r.y1,n.y1),Math.min(r.x2,n.x2),Math.min(r.y2,n.y2),e);return t.x1<t.x2&&t.y1<t.y2?t:j(0,0,0,0,t)}function Fe(r,n){const e=Math.max(r.x,n.x),t=Math.max(r.y,n.y),s=Math.min(r.x+r.width,n.x+n.width)-e,i=Math.min(r.y+r.height,n.y+n.height)-t;return s>0&&i>0?{x:e,y:t,width:s,height:i}:{x:0,y:0,width:0,height:0}}function fe(r,n){return r===n?!0:r===null||n===null?!1:r.x===n.x&&r.y===n.y&&r.width===n.width&&r.height===n.height}function Ue(r){return r.x1<r.x2&&r.y1<r.y2}class de{constructor(n){a(this,"textureSource");this.textureSource=n}}class le{constructor(n){a(this,"stage");this.stage=n}}class xe{}class Te{static makeCacheKey(n){return!1}static resolveDefaults(n){return{}}}function Z(r,n,e){const t=r.createShader(n);if(!t)throw new Error;if(r.shaderSource(t,e),r.compileShader(t),r.getShaderParameter(t,r.COMPILE_STATUS))return t;console.log(r.getShaderInfoLog(t)),r.deleteShader(t)}function Ee(r,n,e){const t=r.createProgram();if(!t)throw new Error;if(r.attachShader(t,n),r.attachShader(t,e),r.linkProgram(t),r.getProgramParameter(t,r.LINK_STATUS))return t;console.log(r.getProgramInfoLog(t)),r.deleteProgram(t)}function X(r){return self.WebGL2RenderingContext&&r instanceof self.WebGL2RenderingContext}class W extends Te{constructor(e){super();a(this,"boundBufferCollection",null);a(this,"buffersBound",!1);a(this,"program");a(this,"vao");a(this,"renderer");a(this,"gl");a(this,"attributeBuffers");a(this,"attributeLocations");a(this,"attributeNames");a(this,"uniformLocations");a(this,"uniformTypes");a(this,"supportsIndexedTextures");const t=this.renderer=e.renderer,s=this.gl=this.renderer.gl;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const i=X(s),o=i&&e.webgl2Extensions||!i&&e.webgl1Extensions||[],h=i?"2.0":"1.0";o.forEach(l=>{if(!s.getExtension(l))throw new Error('Shader "'.concat(this.constructor.name,'" requires extension "').concat(l,'" for WebGL ').concat(h," but wasn't found"))});const u=e.shaderSources||this.constructor.shaderSources;if(u)i&&(u!=null&&u.webGl2)&&(u.fragment=u.webGl2.fragment,u.vertex=u.webGl2.vertex,delete u.webGl2);else throw new Error('Shader "'.concat(this.constructor.name,'" is missing shaderSources.'));const d=t.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,x=u.vertex instanceof Function?u.vertex(d):u.vertex,f=u.fragment instanceof Function?u.fragment(d):u.fragment,R=Z(s,s.VERTEX_SHADER,x),E=Z(s,s.FRAGMENT_SHADER,f);if(!R||!E)throw new Error;const p=Ee(s,R,E);if(!p)throw new Error;if(this.program=p,i){const l=s.createVertexArray();if(!l)throw new Error;this.vao=l,s.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(l=>{const T=s.getAttribLocation(this.program,l);if(T<0)throw new Error("".concat(this.constructor.name,': Vertex shader must have an attribute "').concat(l,'"!'));const _=s.createBuffer();if(!_)throw new Error("".concat(this.constructor.name,': Could not create buffer for attribute "').concat(l,'"'));this.attributeLocations[l]=T,this.attributeBuffers[l]=_,this.attributeNames.push(l)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(l=>{const T=s.getUniformLocation(this.program,l.name);if(this.uniformTypes[l.name]=l.uniform,!T){console.warn('Shader "'.concat(this.constructor.name,'" could not get uniform location for "').concat(l.name,'"'));return}this.uniformLocations[l.name]=T})}bindBufferAttribute(e,t,s){const i=this.gl;i.enableVertexAttribArray(e),i.bindBuffer(i.ARRAY_BUFFER,t),i.vertexAttribPointer(e,s.size,s.type,s.normalized,s.stride,s.offset)}disableAttribute(e){this.gl.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,t){return!1}bindRenderOp(e,t){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{gl:s}=e;if(this.setUniform("u_resolution",[s.canvas.width,s.canvas.height]),this.setUniform("u_pixelRatio",e.options.pixelRatio),t){if(v(t,"$dimensions")){let i=t.$dimensions;i||(i=e.dimensions),this.setUniform("u_dimensions",[i.width,i.height])}if(v(t,"$alpha")){let i=t.$alpha;i||(i=e.alpha),this.setUniform("u_alpha",i)}this.bindProps(t)}}setUniform(e,...t){this.gl[this.uniformTypes[e]](this.uniformLocations[e],...t)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const t in this.attributeLocations){const s=e.getBuffer(t),i=e.getAttributeInfo(t);m(s,'Buffer for "'.concat(t,'" not found')),m(i),this.bindBufferAttribute(this.attributeLocations[t],s,i)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.gl.useProgram(this.program),X(this.gl)&&this.vao&&this.gl.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}a(W,"shaderSources");class _e extends xe{constructor(e,t,s,i,o,h,u,d,x,f){super();a(this,"gl");a(this,"options");a(this,"buffers");a(this,"shader");a(this,"shaderProps");a(this,"alpha");a(this,"clippingRect");a(this,"dimensions");a(this,"bufferIdx");a(this,"zIndex");a(this,"length",0);a(this,"numQuads",0);a(this,"textures",[]);a(this,"maxTextures");this.gl=e,this.options=t,this.buffers=s,this.shader=i,this.shaderProps=o,this.alpha=h,this.clippingRect=u,this.dimensions=d,this.bufferIdx=x,this.zIndex=f,this.gl=e,this.maxTextures=i.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:t,maxTextures:s}=this,i=t.findIndex(h=>h===e);if(i!==-1)return i;const o=t.length;return o>=s?4294967295:(this.textures.push(e),o)}draw(){const{gl:e,shader:t,shaderProps:s,options:i}=this,{shManager:o}=i;o.useShader(t),t.bindRenderOp(this,s);const h=this.bufferIdx/24*6*2;if(e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.clippingRect){const{x:u,y:d,width:x,height:f}=this.clippingRect,R=i.pixelRatio,E=i.canvas.height,p=Math.round(u*R),l=Math.round(x*R),T=Math.round(f*R),_=Math.round(E-T-d*R);e.enable(e.SCISSOR_TEST),e.scissor(p,_,l,T)}else e.disable(e.SCISSOR_TEST);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,h)}}function pe(r){const n={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(n).forEach(t=>{n[t]=r.getParameter(r[t])}),n}function ge(r){const n={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(n).forEach(t=>{n[t]=r.getExtension(t)}),n}function Re(r,n){if(!r)throw new Error("No WebGL context");const e=~~(n/80),t=new Uint16Array(e*6);for(let i=0,o=0;i<e;i+=6,o+=4)t[i]=o,t[i+1]=o+1,t[i+2]=o+2,t[i+3]=o+2,t[i+4]=o+1,t[i+5]=o+3;const s=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}const J=new Uint8Array([0,0,0,0]);class H extends de{constructor(e,t){super(t);a(this,"gl");a(this,"_nativeCtxTexture",null);a(this,"_state","freed");a(this,"_w",0);a(this,"_h",0);this.gl=e}get ctxTexture(){return this._state==="freed"&&this.load(),m(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this.onLoadRequest().then(({width:e,height:t})=>{this._state="loaded",this._w=e,this._h=t,this.textureSource.setState("loaded",{width:e,height:t})}).catch(e=>{this._state="failed",this.textureSource.setState("failed",e),console.error(e)}))}async onLoadRequest(){var o;this._nativeCtxTexture=this.createNativeCtxTexture();const{gl:e}=this;e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,J);const t=await((o=this.textureSource)==null?void 0:o.getTextureData());let s=0,i=0;if(m(this._nativeCtxTexture),t.data instanceof ImageBitmap||t.data instanceof ImageData){const h=t.data;s=h.width,i=h.height,e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!t.premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),(X(e)||Q(s)&&Q(i))&&e.generateMipmap(e.TEXTURE_2D)}else t.data===null?(s=0,i=0,e.bindTexture(e.TEXTURE_2D,this._nativeCtxTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,J)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",t);return{width:s,height:i}}free(){this._state!=="freed"&&(this._state="freed",this._w=0,this._h=0,this._nativeCtxTexture&&(this.gl.deleteTexture(this._nativeCtxTexture),this._nativeCtxTexture=null))}createNativeCtxTexture(){const e=this.gl.createTexture();if(!e)throw new Error("Could not create WebGL Texture");return e}}class $ extends ee{constructor(e){super();a(this,"txManager");a(this,"dimensions",null);a(this,"error",null);a(this,"state","loading");this.txManager=e}setState(e,...t){if(this.state!==e){if(this.state=e,e==="loaded"){const s=t;this.dimensions=s[0]}else if(e==="failed"){const s=t;this.error=s[0]}this.emit(e,...t)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const B=class B extends ${constructor(e,t){super(e);a(this,"props");this.props=B.resolveDefaults(t||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),t=new Uint8ClampedArray(e.buffer);return{data:new ImageData(t,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){const t=B.resolveDefaults(e);return"ColorTexture,".concat(t.color)}static resolveDefaults(e){return{color:e.color||4294967295}}};a(B,"z$__type__Props");let k=B;const P=class P extends ${constructor(e,t){super(e);a(this,"props");a(this,"parentTexture");a(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});a(this,"onParentTxFailed",(e,t)=>{this.setState("failed",t)});this.parentTexture=this.txManager.loadTexture(t.texture.txType,t.texture.props,t.texture.options),this.props=P.resolveDefaults(t||{}),queueMicrotask(()=>{const s=this.parentTexture;s.state==="loaded"?this.onParentTxLoaded(s,s.dimensions):s.state==="failed"&&this.onParentTxFailed(s,s.error),s.on("loaded",this.onParentTxLoaded),s.on("failed",this.onParentTxFailed)})}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};a(P,"z$__type__Props");let N=P;class Ae extends H{constructor(n,e){super(n,e)}async onLoadRequest(){var e,t;const n=await this.textureSource.getTextureData();return{width:((e=n.data)==null?void 0:e.width)||0,height:((t=n.data)==null?void 0:t.height)||0}}}class me{constructor(n){a(this,"config");this.config=n}getBuffer(n){var e;return(e=this.config.find(t=>t.attributes[n]))==null?void 0:e.buffer}getAttributeInfo(n){var e;return(e=this.config.find(t=>t.attributes[n]))==null?void 0:e.attributes[n]}}const Ie=24;class we extends le{constructor(e){super(e.stage);a(this,"gl");a(this,"system");a(this,"txManager");a(this,"shManager");a(this,"options");a(this,"quadBuffer",new ArrayBuffer(1024*1024*4));a(this,"fQuadBuffer",new Float32Array(this.quadBuffer));a(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer));a(this,"renderOps",[]);a(this,"curBufferIdx",0);a(this,"curRenderOp",null);a(this,"renderables",[]);a(this,"defaultShader");a(this,"quadBufferCollection");a(this,"defaultTexture");const{canvas:t,clearColor:s,bufferMemory:i}=e;this.options=e,this.txManager=e.txManager,this.shManager=e.shManager,this.defaultTexture=new k(this.txManager);const o=ue(t);if(!o)throw new Error("Unable to create WebGL context");this.gl=o;const h=he(s);o.viewport(0,0,t.width,t.height),o.clearColor(h[0],h[1],h[2],h[3]),Re(o,i),this.system={parameters:pe(o),extensions:ge(o)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;const u=o.createBuffer();m(u);const d=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new me([{buffer:u,attributes:{a_position:{name:"a_position",size:2,type:o.FLOAT,normalized:!1,stride:d,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:o.FLOAT,normalized:!1,stride:d,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:o.UNSIGNED_BYTE,normalized:!0,stride:d,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:o.FLOAT,normalized:!1,stride:d,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,this.gl.disable(this.gl.SCISSOR_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof N?new Ae(this.gl,e):new H(this.gl,e)}addQuad(e){var V,q;const{fQuadBuffer:t,uiQuadBuffer:s}=this,{width:i,height:o,colorTl:h,colorTr:u,colorBl:d,colorBr:x,textureOptions:f,shader:R,shaderProps:E,alpha:p,clippingRect:l,tx:T,ty:_,ta:G,tb:D,tc:F,td:U}=e;let{texture:I}=e;if(E&&v(E,"$dimensions")){const C=E.$dimensions;C.width=i,C.height=o}I=I!=null?I:this.defaultTexture,m(I instanceof $,"Invalid texture type");let{curBufferIdx:c,curRenderOp:A}=this;const te={width:i,height:o},L=R||this.defaultShader;m(L instanceof W),A&&(A.shader!==L||!fe(A.clippingRect,l)||A.shader!==this.defaultShader&&(!E||!A.shader.canBatchShaderProps(A.shaderProps,E)))&&(A=null),m(L instanceof W),A||(this.newRenderOp(L,E,p,te,l,c),A=this.curRenderOp,m(A));const re=(V=f==null?void 0:f.flipX)!=null?V:!1,se=(q=f==null?void 0:f.flipY)!=null?q:!1;let w=0,S=0,M=1,b=1;if(I instanceof N){const{x:C,y:O,width:ie,height:ae}=I.props,{width:z=0,height:K=0}=I.parentTexture.dimensions||{width:0,height:0};w=C/z,M=w+ie/z,S=O/K,b=S+ae/K,I=I.parentTexture}re&&([w,M]=[M,w]),se&&([S,b]=[b,S]);const{txManager:ne}=this.stage,Y=ne.getCtxTexture(I);m(Y instanceof H);const y=this.addTexture(Y,c);if(A=this.curRenderOp,m(A),D!==0||F!==0)t[c++]=T,t[c++]=_,t[c++]=w,t[c++]=S,s[c++]=h,t[c++]=y,t[c++]=T+i*G,t[c++]=_+i*F,t[c++]=M,t[c++]=S,s[c++]=u,t[c++]=y,t[c++]=T+o*D,t[c++]=_+o*U,t[c++]=w,t[c++]=b,s[c++]=d,t[c++]=y,t[c++]=T+i*G+o*D,t[c++]=_+i*F+o*U,t[c++]=M,t[c++]=b,s[c++]=x,t[c++]=y;else{const C=T+i*G,O=_+o*U;t[c++]=T,t[c++]=_,t[c++]=w,t[c++]=S,s[c++]=h,t[c++]=y,t[c++]=C,t[c++]=_,t[c++]=M,t[c++]=S,s[c++]=u,t[c++]=y,t[c++]=T,t[c++]=O,t[c++]=w,t[c++]=b,s[c++]=d,t[c++]=y,t[c++]=C,t[c++]=O,t[c++]=M,t[c++]=b,s[c++]=x,t[c++]=y}A.length+=Ie,A.numQuads++,this.curBufferIdx=c}newRenderOp(e,t,s,i,o,h){const u=new _e(this.gl,this.options,this.quadBufferCollection,e,t,s,o,i,h,0);this.curRenderOp=u,this.renderOps.push(u)}addTexture(e,t,s){const{curRenderOp:i}=this;m(i);const o=i.addTexture(e);if(o===4294967295){if(s)throw new Error("Unable to add texture to render op");const{shader:h,shaderProps:u,dimensions:d,clippingRect:x,alpha:f}=i;return this.newRenderOp(h,u,f,d,x,t),this.addTexture(e,t,!0)}return o}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){var h;const{gl:t,quadBuffer:s}=this,i=new Float32Array(s,0,this.curBufferIdx),o=(h=this.quadBufferCollection.getBuffer("a_position"))!=null?h:null;t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),this.renderOps.forEach((u,d)=>{u.draw()}),this.renderables=[]}}class Se extends ee{constructor(e,t){super();a(this,"fontFamily");a(this,"descriptors");a(this,"loaded",!1);this.fontFamily=e,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...t}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?"".concat(e.weight):e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,variant:e.variant,featureSettings:e.featureSettings,display:e.display}}}const ye={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class Me{}class be extends Me{constructor(e){super();a(this,"data");a(this,"kernings");this.data=e;const t=this.kernings={};e.kernings.forEach(s=>{const i=s.second,o=t[i]=t[i]||{};o[s.first]=s.amount}),this.kernings=t}*shapeText(e,t){var o;let s,i;for(;(s=t.peek())&&!s.done;){const h=s.value,u=this.data.chars.find(d=>d.id===h);if(t.next(),u!==void 0){const d=i!==void 0?(((o=this.kernings[u.id])==null?void 0:o[i])||0)+e.letterSpacing:0;i=u.id,yield{mapped:!0,glyphId:u.id,codepoint:h,cluster:t.lastIndex,xAdvance:u.xadvance+d,yAdvance:0,xOffset:u.xoffset+d,yOffset:u.yoffset,xBearing:0,yBearing:0,width:u.width,height:u.height}}else h===ye.LINE_FEED&&(i=void 0),yield{mapped:!1,codepoint:h,cluster:t.lastIndex}}}}class ve extends Se{constructor(e,t,s,i,o,h){super(e,t);a(this,"type");a(this,"texture");a(this,"data");a(this,"shaper");a(this,"glyphMap",new Map);this.type=s;const u=i.renderer;m(u instanceof we,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=i.txManager.loadTexture("ImageTexture",{src:o,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",()=>{this.checkLoaded()}),fetch(h).then(async d=>{this.data=await d.json(),this.shaper=new be(this.data),this.data.chars.forEach(x=>{this.glyphMap.set(x.id,x)}),this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const t=this.glyphMap.get(e);if(t===void 0)throw new Error("Glyph ".concat(e," not found in font ").concat(this.fontFamily));return{x:t.x,y:t.y,width:t.width,height:t.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}class Xe{}export{me as B,Xe as C,ee as E,ve as S,$ as T,W,m as a,Oe as b,he as c,k as d,N as e,Se as f,Ne as g,Ue as h,Fe as i,j,De as k,_e as l,Be as m,Le as n,Ge as o,Pe as p,we as q};
//# sourceMappingURL=CoreExtension-8a5de560.js.map
